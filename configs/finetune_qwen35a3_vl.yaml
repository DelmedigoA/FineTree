run:
  name: qwen35a3-vl-finetree
  seed: 3407
  output_dir: artifacts/qwen35a3-vl-finetree

model:
  base_model: unsloth/Qwen3.5-35B-A3B
  max_seq_length: 4096
  load_in_4bit: true
  dtype: bfloat16
  trust_remote_code: true

data:
  annotations_glob: data/annotations/*.json
  images_root: .
  output_train_jsonl: data/finetune/train.jsonl
  output_val_jsonl: data/finetune/val.jsonl
  split_strategy: by_document
  val_ratio: 0.1
  include_empty_pages: true
  bbox_policy: include_if_present
  bbox_space: pixel
  target_schema: finetree_exact_json
  sample_granularity: page

prompt:
  use_custom_prompt: true
  prompt_path: prompt.txt
  fallback_template: |
    You are extracting financial statement annotations from a single page image.
    Return strict JSON with keys: meta, facts.

adapter:
  mode: lora
  r: 4
  alpha: 8
  dropout: 0.0
  bias: none
  target_modules: auto
  use_rslora: false
  gradient_checkpointing: unsloth

training:
  per_device_train_batch_size: 1
  gradient_accumulation_steps: 16
  learning_rate: 0.0002
  num_train_epochs: 2
  warmup_ratio: 0.03
  weight_decay: 0.01
  lr_scheduler_type: cosine
  optim: adamw_8bit
  logging_steps: 10
  save_strategy: steps
  save_steps: 100
  eval_strategy: steps
  eval_steps: 100
  load_best_model_at_end: true
  metric_for_best_model: eval_loss
  greater_is_better: false
  save_total_limit: 3
  logging_first_step: true
  require_val_set: true
  compute_token_accuracy: true
  bf16: true
  fp16: false
  report_to: none

infra:
  single_gpu_offload: true
  enable_model_cpu_offload: true
  dataloader_num_workers: 2

push_to_hub:
  enabled: false
  repo_id: null
  hf_token: null
  hf_token_env: FINETREE_HF_TOKEN
  default_artifact: adapters_only
  upload_training_logs: false
  training_logs_path_in_repo: training_logs

inference:
  backend: local
  model_path: null
  adapter_path: null
  endpoint_base_url: null
  endpoint_status_base_url: null
  endpoint_api_key: null
  endpoint_api_key_env: RUNPOD_API_KEY
  endpoint_model: null
  endpoint_timeout_sec: 180
  parser_mode: streaming_page_extraction
  max_new_tokens: 4096
  temperature: 0.0
  top_p: 0.95
  do_sample: false
  torch_dtype: auto
  device_map: auto
  trust_remote_code: true
  load_in_4bit: false
